---
title: "クリーンアーキテクチャについて考える"
emoji: "🕌"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["Clean Architecture","Architecture"]
published: false
---

## 概要
サービスのアーキテクチャを考える上で、様々な手法が存在している。
今回はクリーンアーキテクチャを取り入れることを考えている。
考えを理解したうえでフォルダ構成についてまとめる。

## 前提
クリーンアーキテクチャを採用するが、少し簡易的な構成を選択する。
理由としては、チームではなく個人運用であるサービスの構成案のため
複雑にしすぎても運用しきれないと考えているためである。
決まっていることとしては
- 言語はGo言語
- DataBaseはMySQL
- O/RマッパーはSQLBoilerの予定している（未確定だが、何かしらは使うつもり）

## クリーンアーキテクチャって？
![](/images/clean-arche/image.png)
引用　https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html

クリーンアーキテクチャといえば、この絵を見たことがある人は多いはず。
クリーンアーキテクチャのルールを表現するには非常に優れた絵だと思っています。
この絵が示しているルールは
- ソフトウェアはレイヤーに分割することで関心事を分離する
- ソースコードは円の内側の方向にのみ依存する
- 制御の流れと依存関係を逆転させて依存の方向を制御する

となっています。

### ソフトウェアはレイヤーに分割することで関心事を分離する
クリーンアーキテクチャに限らず、レイヤーを分割することは多くのアーキテクチャではよくある考え方です。
ですが、分割することで関心事を分離するとあることが重要な要素です。
関心事とは、プログラムの目的や役割ごとのクラスや関数などのアプリケーションを構成要素を指しています。
話を分かりやすくするためにIDとパスワードで認証するAPIを使って話を補足します。
IDとパスワードで認証するので認証成功時の処理の流れとしては、
1. リクエストを受け取る
2. リクエストパラメーターがすべてあること
3. IDのデータがあるか確認
4. IDに対応するパスワードとリクエストパラメータのパスワードが一致確認
5. 認証成功のレスポンスを返す

といった流れになります。
処理フローとして書いてしまうとすべて同等にみえてしましますが、
1,5はAPIとしてのInterfaceになります。指定されたリクエストと成功時のレスポンスです。
2,3,4は必要なビジネスロジックですし、3はより正確に分類するならDBへの問い合わせです。
このように、外の世界からみたときに役割を正しく分割することで密な依存関係を避ける狙いもあります。
APIはWebとして扱うので
1,5はInterce Adapter層のControllerとPresenterにあたります。
2,3,4はApplication Business RulesとしてUsecaseにあたります。
3に関しはDataBaseがかかわっているため、Interce Adapter層のGatewayが絡んでくる様子を含んでいます。

3をより正確に表現するならば
3-1. DataBaseにIDをつかって問い合わせ
3-2. 取得した情報をEntitiesに定めているクラスに格納
といった流れになりますので、3-1がGateway、3-2がUsecaseにあたります。


### ソースコードは円の内側の方向にのみ依存する
### 制御の流れと依存関係を逆転させて依存の方向を制御する