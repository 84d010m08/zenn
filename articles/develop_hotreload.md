---
title: "開発環境の整備のためのホットリロード"
emoji: "🕌"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["Golang","HotReload", "air"]
published: false
---

## 概要

EchoのAPI開発環境の整備のためにホットリロードを導入する。
また、WindowsでのDocker環境を使ったため少々特殊な事象が発生したのでそちらについてもまとめる。

## ホットリロードの必要性

GoのWebアプリケーションの開発環境において、ホットリロードが欲しくなるケースはある。
それは、一度実行されてしまうと状態を保持してしまうためだ。
何かしらの修正を行った際に、実行しなおさないと修正内容が正しく反映されているか確認がとれない。
開発時もそうだし、バグの検証などでデバックコードを埋め込んだりすることにおいて実行しなおしは効率が下がる要因になりやすい。
そこで、ホットリロードを採用して開発環境において、修正した際に都度再実行（リロード）してもうらようにしてこの問題を解消する。
注意点としては、修正に対して自動で再実行されてしまうので、状態を保持したかった債などは注意が必要になる。特にIDEで自動保存が有効になっていると意図していない状態でリロードされる場合があるので気をつける必要がある。

## airの導入

### 前提

今回は以下の環境が構築済みである前提で話をすすめる。
ホストPCはWindowsだが、Docker環境を用意し、コンテナ内で作成しているGoのアプリケーションを開発を行う。
Docker環境の管理はdocker-ccomposeを使って管理をする。
すでにdocker-compose.ymlが起動確認まで取れている状態のもの状態とします。

### 導入

Dockerfileに以下の内容を追記します。

``` docker

```

この状態で`docker compose build`を行いコンテナを作り直します。
ビルドができたらコンテナを立ち上げ、Goアプリケーションのコンテナに入ります。

先のDockerfileの編集が問題なければ、airに関するコマンドを扱えるようになっています。
airのイニシャルコマンドを実行します。

``` cmd

```

#### Windows固有の対応

ホストPCがWindowsの場合、初期状態ではホットリロードが効かない（はず）です。
これはホストPCとコンテナ間のボリュームマウントが関係する問題で、airの設定を直す必要があります。


＊経験則ですが、Docker Desktopなどでなく、wsl2を使った環境でコンテナ管理を行っている場合は、Linux環境でのボリュームマウントになりますのでこの設定は不要です。

